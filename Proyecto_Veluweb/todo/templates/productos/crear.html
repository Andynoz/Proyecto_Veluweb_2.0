{% extends "todo/layout.html" %}

{% block content %}
<div class="container mt-5">
    <div class="card shadow-lg p-4 rounded-4">
        <h2 class="text-center mb-4">
            <i class="fas fa-box-open me-2 text-success"></i>Registrar Nuevo Producto
        </h2>
        {% if form.errors %}
        <div class="alert alert-danger">
            <strong>¡Atención!</strong> Hay errores en el formulario:
            <ul>
                {% for field in form %}
                {% for error in field.errors %}
                <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                {% endfor %}
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
            {% csrf_token %}
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="id_nombre" class="form-label">
                        <i class="fas fa-tag text-primary me-1"></i> Nombre del Producto
                    </label>
                    {{ form.nombre }}
                    <div class="invalid-feedback">Ingresa un nombre válido.</div>
                </div>
                <div class="col-md-4">
                    <label for="id_codigo" class="form-label">
                        <i class="fas fa-barcode text-info me-1"></i> Código del Producto
                    </label>
                    {{ form.codigo }}
                    <div class="invalid-feedback">Ingresa un código válido.</div>
                </div>
                <div class="col-md-4">
                    <label for="id_precio" class="form-label">
                        <i class="fas fa-dollar-sign text-success me-1"></i> Precio
                    </label>
                    {{ form.precio }}
                    <div class="invalid-feedback">El precio debe ser mayor a cero.</div>
                </div>
            </div>

            <div class="mb-3">
                <label for="id_descripcion" class="form-label">
                    <i class="fas fa-align-left text-secondary me-1"></i> Descripción
                </label>
                {{ form.descripcion }}
                <div class="invalid-feedback">Por favor añade una descripción.</div>
            </div>

            <div class="mb-4">
                <label for="id_imagen" class="form-label">
                    <i class="fas fa-image text-warning me-1"></i> Imagen del Producto
                </label>
                {{ form.imagen }}
                <img id="imagePreview" class="mt-3 rounded" style="max-height: 150px; display: none;" />
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-success px-4 rounded-pill shadow-sm">
                    <i class="fas fa-check-circle me-2"></i>Guardar Producto
                </button>
                <a href="{% url 'productos_index' %}" class="btn btn-secondary rounded-pill ms-2">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Previsualización de imagen -->
<script>
function previewImage(event) {
    const input = event.target;
    const preview = document.getElementById('imagePreview');

    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function (e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
    }
}
</script>

<!-- Validación visual de Bootstrap -->
<script>
(() => {
    'use strict'
    const forms = document.querySelectorAll('.needs-validation')
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
            }
            form.classList.add('was-validated')
        }, false)
    })
})()
</script>
{% endblock %}
