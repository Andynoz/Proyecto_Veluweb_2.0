{% extends "todo/layout2.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">


<div class="container mt-4">
    <h1 class="mb-4 text-center">📦 Productos Disponibles</h1>
    
<div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-2 px-1">
    <a href="{% url 'productos_index' %}" class="btn btn-primary">Volver</a>
<form method="GET" action="{% url 'productos_index' %}" class="form-inline d-flex mb-3" style="gap: 10px;">
    <input
      type="text"
      name="buscar"
      class="form-control buscador-input"
      placeholder="🔍 Ingresar descripción del producto"
      value="{{ request.GET.buscar }}"
    >
    <button type="submit" class="btn btn-primary">Buscar</button>
</form>


    <a href="{% url 'crear_producto' %}" class="btn btn-outline-danger shadow-sm">
        <i class="fas fa-plus-circle me-1"></i> Agregar producto
    </a>
</div>

<div class="table-responsive shadow-sm">
    <table class="table table-striped table-hover text-center align-middle">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Código</th>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Precio</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for producto in productos %}
            <tr>
                <td>{{ producto.id }}</td>
                <td>{{ producto.codigo }}</td>
                <td>
                    {% if producto.imagen %}
                        <img src="{{ producto.imagen.url }}" alt="Imagen de {{ producto.nombre }}" class="rounded shadow-sm" width="60" height="60" style="object-fit: cover;">
                    {% else %}
                        <span class="text-muted">Sin imagen</span>
                    {% endif %}
                </td>
                <td>{{ producto.nombre }}</td>
                <td>{{ producto.descripcion|truncatechars:40 }}</td>
                <td>${{ producto.precio }}</td>
                <td>
                    <div class="d-flex justify-content-center gap-2">
                        <a href="{% url 'editar_producto' producto.id %}" class="btn btn-warning btn-sm" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#confirmarEliminar{{ producto.id }}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center text-muted">No hay productos registrados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

</div>

<!-- MODALES DE CONFIRMACIÓN -->
{% for producto in productos %}
<div class="modal fade" id="confirmarEliminar{{ producto.id }}" tabindex="-1" aria-labelledby="modalLabel{{ producto.id }}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="modalLabel{{ producto.id }}">¿Eliminar producto?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                Estás a punto de eliminar <strong>{{ producto.nombre }}</strong>. Esta acción no se puede deshacer.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form method="POST" action="{% url 'eliminar_producto' producto.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Eliminar</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endfor %}


<!-- PAGINACIÓN -->
<div class="d-flex justify-content-between align-items-center mt-4 px-2">
    <div class="text-muted">
        Total de productos: {{ productos.paginator.count }}
    </div>
    <nav>
        <ul class="pagination mb-0">
            {% if productos.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ productos.previous_page_number }}">Anterior</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Anterior</span></li>
            {% endif %}

            {% for num in productos.paginator.page_range %}
                {% if productos.number == num %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}

            {% if productos.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ productos.next_page_number }}">Siguiente</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
            {% endif %}
        </ul>
    </nav>
</div>

{% endblock %}
